<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <title>Master Quiz - Polyglotte App</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>

    <div id="screen-home" class="screen">
        <h1>ğŸŒ Polyglotte App</h1>
        <div class="menu-grid">
            <br><button onclick="showScreen('screen-quiz')">ğŸ—‚ï¸ Vocabulaire & Morse</button></br>
            <br><button onclick="showScreen('screen-text'); startOralTraining()">ğŸ‘‚ Apprentissage Oral</button></br>
            <br><button onclick="showScreen('screen-chat')">ğŸ’¬ Translate</button></br>
            <br><button onclick="showScreen('screen-music')" class="btn-music">ğŸµ Mode KaraokÃ©</button></br>
            <br><button onclick="toggleInventory()">ğŸ” INVENTAIRE & STATS</button></br>
            <br><button id="install-btn" style="padding:15px; background:gray; color:white; border:none; border-radius:8px; cursor:pointer;">
                Installer les musiques (Mode Hors-ligne)
            </button>
            <p id="status-msg" style="font-size: 14px; color: #555;">Statut : Non lancÃ©</p></br>
            <br>
                <button onclick="exportData()" style="background: #2196F3; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer;">
                    ğŸ“¤ Exporter Stats
                </button>
            </br>
            <br>
                <button onclick="document.getElementById('importFile').click()" style="background: #ff9800; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer;">
                    ğŸ“¥ Importer Stats
                </button>
                <input type="file" id="importFile" style="display:none" accept=".json" onchange="importData(event)">

            </br>
        </div>
    </div>

    <div id="screen-quiz" class="screen" style="display:none;">
        <button class="btn-back" onclick="showScreen('screen-home')">â¬…ï¸ Menu</button>
        
        <div id="progress-container"><div id="progBar"></div></div>

        <div id="light" onclick="startQuiz()">TAP START</div>

        <div class="controls">
            <select id="modeSelect" onchange="startQuiz()">
                <option value="francais_soutenu">FranÃ§ais (Soutenu) ğŸ‡«ğŸ‡·</option>
                <option value="morse_lettres">Morse (Lettres)</option>
                <option value="morse_mots">Morse (Mots)</option>
                <option value="anglais">Anglais ğŸ‡¬ğŸ‡§</option>
                <option value="espagnol">Espagnol ğŸ‡ªğŸ‡¸</option>
                <option value="italien">Italien ğŸ‡®ğŸ‡¹</option>
                <option value="allemand">Allemand ğŸ‡©ğŸ‡ª</option>
                <option value="chinois">Chinois ğŸ‡¨ğŸ‡³</option>
                <option value="coreen">CorÃ©en ğŸ‡°ğŸ‡·</option>
                <option value="arabe">Arabe ğŸ‡¸ğŸ‡¦</option>
                <option value="russe">Russe ğŸ‡·ğŸ‡º</option>
                <option value="basque">Basque âšªğŸ”´ğŸŸ¢</option>
                <option value="grec">Grec ğŸ‡¬ğŸ‡·</option>
                <option value="hindi">Hindi ğŸ‡®ğŸ‡³</option>
                <option value="egyptien">Ã‰gyptien (HiÃ©roglyphes) ğ“‹¹</option>
            </select>
            
            <div style="color: #888; font-size: 0.8em; margin-top: 10px;">Vitesse Morse</div>
            <input type="range" id="speed" min="50" max="350" value="220" style="width: 70vw;">
            
            <input type="text" id="answer" placeholder="Ta rÃ©ponse..." autocomplete="off">

            <button id="switchBtn" onclick="toggleDirection()">ğŸ”„ Sens : Langue â” FR</button>

            <div class="btn-group">
                <button class="btn-check" onclick="check()">VALIDER</button>
                <button onclick="playMorse(currentAnswer)">ğŸ‘ï¸ REVOIR</button>
                <button class="btn-next" onclick="startQuiz()">SUIVANT</button>
            </div>
            
        </div>
    </div>

    <div id="screen-text" class="screen" style="display:none;">
        <button class="btn-back" onclick="showScreen('screen-home')">â¬…ï¸ Menu</button>
        <h2 style="color: #4CAF50;">Apprentissage Oral</h2>

        <select id="oralModeSelect" onchange="updateOralUI(); startOralTraining()" style="width: 80%; padding: 10px; margin-bottom: 10px;">
            <option value="francais_soutenu">FranÃ§ais (Soutenu) ğŸ‡«ğŸ‡·</option>
            <option value="morse_lettres">Morse (Lettres)</option>
            <option value="morse_mots">Morse (Mots)</option>
            <option value="anglais">Anglais ğŸ‡¬ğŸ‡§</option>
            <option value="espagnol">Espagnol ğŸ‡ªğŸ‡¸</option>
            <option value="italien">Italien ğŸ‡®ğŸ‡¹</option>
            <option value="allemand">Allemand ğŸ‡©ğŸ‡ª</option>
            <option value="chinois">Chinois ğŸ‡¨ğŸ‡³</option>
            <option value="coreen">CorÃ©en ğŸ‡°ğŸ‡·</option>
            <option value="arabe">Arabe ğŸ‡¸ğŸ‡¦</option>
            <option value="russe">Russe ğŸ‡·ğŸ‡º</option>
            <option value="basque">Basque âšªğŸ”´ğŸŸ¢</option>
            <option value="grec">Grec ğŸ‡¬ğŸ‡·</option>
            <option value="hindi">Hindi ğŸ‡®ğŸ‡³</option>
        </select>
        

        <div id="oral-ui-container">
            <div id="lives-container" style="font-size: 1.2em; margin-bottom: 10px;">â¤ï¸â¤ï¸â¤ï¸â¤ï¸</div>
            
            <select id="difficultySelect" onchange="startOralTraining()" style="margin-bottom: 15px; padding: 8px;">
                <option value="easy">Niveau : Facile (4 vies)</option>
                <option value="medium">Niveau : Moyen (3 vies)</option>
                <option value="hard">Niveau : Difficile (2 vies)</option>
                <option value="expert">Niveau : Expert (1 vie)</option>
            </select>

            <div id="text-display" class="oral-card">
                <p>ğŸ‘‚ Ã‰coutez attentivement...</p>
                <button class="btn-audio" onclick="playOralAudio()" style="font-size: 2em; padding: 20px; border-radius: 50%; width: 80px; height: 80px; background: #4CAF50; border: none; color: white; cursor: pointer;">ğŸ”Š</button>
                <p style="margin-top: 10px; color: #888;">Cliquez pour rÃ©Ã©couter</p>
            </div>

            <div class="controls">
                <input type="text" id="oralAnswer" placeholder="Traduisez ce que vous entendez..." autocomplete="off" style="margin-top: 20px;">
                <div id="wrapper-reverse">
                    <button id="btn-reverse" onclick="toggleReverse()">ğŸ”„ Inverser Langue</button>
                </div>

                <div id="wrapper-morse-speed" style="display: none; width: 85%; max-width: 320px; margin: 10px 0;">
                    <label style="color: #ffd700; font-size: 0.8em; display: block; margin-bottom: 5px;">âš¡ Vitesse Morse</label>
                    <input type="range" id="morseSpeed" min="50" max="200" value="120" style="width: 100%;">
                </div>
                
                <button class="btn-check" onclick="checkOralAnswer()" style="width: 100%;">VALIDER</button>
            </div>
        </div>
    </div>

    <div id="screen-chat" class="screen" style="display:none;">
        <button class="btn-back" onclick="showScreen('screen-home')">â¬…ï¸ Menu</button>
        <h2>ğŸ’¬ Traducteur Offline</h2>
    
        <select id="translateLangSelect" onchange="instantTranslate()" style="width: 85vw; max-width: 320px;">
            <option value="all">ğŸŒ Toutes les langues</option>
            <option value="anglais">Anglais ğŸ‡¬ğŸ‡§</option>
            <option value="espagnol">Espagnol ğŸ‡ªğŸ‡¸</option>
            <option value="italien">Italien ğŸ‡®ğŸ‡¹</option>
            <option value="allemand">Allemand ğŸ‡©ğŸ‡ª</option>
            <option value="chinois">Chinois ğŸ‡¨ğŸ‡³</option>
            <option value="coreen">CorÃ©en ğŸ‡°ğŸ‡·</option>
            <option value="arabe">Arabe ğŸ‡¸ğŸ‡¦</option>
            <option value="russe">Russe ğŸ‡·ğŸ‡º</option>
            <option value="basque">Basque âšªğŸ”´ğŸŸ¢</option>
            <option value="grec">Grec ğŸ‡¬ğŸ‡·</option>
            <option value="hindi">Hindi ğŸ‡®ğŸ‡³</option>
            <option value="egyptien">Ã‰gyptien (HiÃ©roglyphes) ğ“‹¹</option>
        </select>

        <button id="translateReverseBtn" onclick="toggleTranslateDirection()" style="margin: 10px auto; display: block;">
            ğŸ”„ Sens : Auto
        </button>

        <input type="text" id="offlineSearch" onkeyup="instantTranslate()" placeholder="Entrez un mot..." autocomplete="off">
        <div id="offlineResult"></div>
    </div>

    <div id="inventoryModal" style="display:none;">
        <button onclick="toggleInventory()" style="background:red; width: 100px; border:none; margin-bottom: 20px; color:white; padding:10px; border-radius:5px;">FERMER</button>
        <h2 style="color:#4CAF50">Statistiques</h2>
        <div id="statsContent" style="text-align:left; border: 1px solid #333; padding: 10px; font-size: 0.9em; margin-bottom: 20px;"></div>



        <div class="modal-content">
            <h2>ğŸ“Š Statistiques & Inventaire</h2>

            <div id="statsContent" style="margin-bottom: 15px; font-size: 0.9em; text-align: left;"></div>

            <div style="margin-bottom: 15px; background: #222; padding: 10px; border-radius: 8px;">
                <label style="font-size: 0.8em; color: #888;">MaÃ®trise min : <b id="threshold-val" style="color: #ffd700;">1</b> rÃ©ussite(s)</label>
                <input type="range" id="mastery-threshold" min="1" max="50" value="1" 
                        oninput="updateThresholdDisplay(this.value)" style="width: 100%;">
                
                <div style="display: flex; gap: 5px; margin-top: 10px;">
                    <button onclick="renderCompletionStats('lecture')" style="flex:1; padding:5px; font-size:0.7em;">ğŸ‘ï¸ LECTURE</button>
                    <button onclick="renderCompletionStats('oral')" style="flex:1; padding:5px; font-size:0.7em;">ğŸ‘‚ ORAL</button>
                </div>
            </div>

            <div id="completion-chart" style="margin-bottom: 20px;"></div>

            <div id="inventoryContent"></div>
        </div>

        <h2>ğŸ“¦ Mon Vocabulaire</h2>

        <select id="inventoryLangSelect" onchange="renderInventory()" style="width:100%; padding:10px; margin-bottom:10px;">
            <option value="francais_soutenu">FranÃ§ais (Soutenu) ğŸ‡«ğŸ‡·</option>
            <option value="morse_lettres">Morse (Lettres)</option>
            <option value="anglais">Anglais ğŸ‡¬ğŸ‡§</option>
            <option value="espagnol">Espagnol ğŸ‡ªğŸ‡¸</option>
            <option value="italien">Italien ğŸ‡®ğŸ‡¹</option>
            <option value="allemand">Allemand ğŸ‡©ğŸ‡ª</option>
            <option value="chinois">Chinois ğŸ‡¨ğŸ‡³</option>
            <option value="coreen">CorÃ©en ğŸ‡°ğŸ‡·</option>
            <option value="arabe">Arabe ğŸ‡¸ğŸ‡¦</option>
            <option value="russe">Russe ğŸ‡·ğŸ‡º</option>
            <option value="basque">Basque âšªğŸ”´ğŸŸ¢</option>
            <option value="grec">Grec ğŸ‡¬ğŸ‡·</option>
            <option value="hindi">Hindi ğŸ‡®ğŸ‡³</option>
            <option value="egyptien">Ã‰gyptien (HiÃ©roglyphes) ğ“‹¹</option>    
        </select>
        <input type="text" id="searchInput" onkeyup="renderInventory()" placeholder="Chercher un mot...">
    
        <div class="sort-buttons" style="display: flex; gap: 10px; margin: 10px 0; justify-content: center;">
            <button onclick="currentSort='alpha'; renderInventory()" style="flex: 1; max-width: 120px;">ğŸ”¤ A-Z</button>

            <div style="flex: 1; max-width: 180px; position: relative;">
                <select id="topPicker" onchange="applyTopSort(this.value)" style="width: 100%; background: #ffd700; color: black; font-weight: bold; border: none;">
                    <option value="" disabled selected>ğŸ† Trier par...</option>
                    <option value="score">ğŸ‘ï¸ Meilleurs Lecture</option>
                    <option value="scoreOral">ğŸ‘‚ Meilleurs Oral</option>
                    <hr>
                    <option value="worstLecture">âŒ Pires Lecture (Erreurs)</option>
                    <option value="worstOral">âŒ Pires Oral (Erreurs)</option>
                </select>
            </div>
        </div>

        <div id="inventory-list" style="max-height: 300px; overflow-y: auto; border: 1px solid #333; padding: 10px;"></div>
    </div>

    <div id="screen-music" class="screen" style="display:none; --mood-color: #ff00ff;">
        <div id="side-panel" class="side-panel">
            <div class="panel-handle">âš™ï¸</div>
            <div class="panel-content">
                <label>Mode d'affichage</label>
                <select id="helpModeSelect" onchange="setHelp(this.value)">
                    <option value="none">ğŸŒ‘ Ombre</option>
                    <option value="text" selected>ğŸ“œ Texte</option>
                    <option value="full">ğŸŒŸ Aide Totale</option>
                    <option value="hidden">ğŸ™ˆ Masquer Tout</option>
                </select>
                
                <label>Langue</label>
                <select id="musicLang" onchange="updateMusicList()">
                    <option value="anglais">Anglais ğŸ‡¬ğŸ‡§</option>
                    <option value="espagnol">Espagnol ğŸ‡ªğŸ‡¸</option>
                    <option value="italien">Italien ğŸ‡®ğŸ‡¹</option>
                    <option value="allemand">Allemand ğŸ‡©ğŸ‡ª</option>
                    <option value="chinois">Chinois ğŸ‡¨ğŸ‡³</option>
                    <option value="coreen">CorÃ©en ğŸ‡°ğŸ‡·</option>
                    <option value="arabe">Arabe ğŸ‡¸ğŸ‡¦</option>
                    <option value="russe">Russe ğŸ‡·ğŸ‡º</option>
                    <option value="basque">Basque âšªğŸ”´ğŸŸ¢</option>
                    <option value="grec">Grec ğŸ‡¬ğŸ‡·</option>
                    <option value="hindi">Hindi ğŸ‡®ğŸ‡³</option>
                </select>

                <label>Niveau</label>
                <select id="difficulty">
                    <option value="1">Niveau 1 (Zen)</option>
                    <option value="2">Niveau 2 (RythmÃ©)</option>
                    <option value="3">Niveau 3 (Ã‰nergique)</option>
                    <option value="4">Niveau 4 (PsychÃ©dÃ©lique)</option>
                </select>

                <button onclick="stopMusic()" class="btn-stop-music">ğŸ›‘ STOP</button>
                <button id="btn-eco" onclick="toggleEcoMode()" style="background: #222; border: 1px dashed #555;">
                    ğŸƒ Mode Ã‰co : OFF
                </button>
            </div>
        </div>

        <button class="btn-back-music" onclick="retourMusic()">â¬…ï¸</button>

        <div class="music-ui-centered">
            <h2 id="song-title" class="song-neon-title">Choisissez une mÃ©lodie</h2>
            
            <div id="lyrics-container">
                <p id="lyrics-prev" class="lyric-fade"></p>
                <div id="lyrics-active" class="lyric-main">Lancez la musique...</div>
                <p id="lyrics-next" class="lyric-fade"></p>
                <p id="translation" class="lyric-trans"></p>
            </div>

            <button id="btn-play-main" class="btn-play-neon" onclick="loadSong(document.getElementById('musicLang').value, document.getElementById('difficulty').value)">
                â–¶ï¸ LANCER
            </button>
        </div>

        <div class="visualizer-full">
            <div class="blob-bottom"></div>
        </div>
    </div>

    <script src="vocabulaire.js"></script>
    <script src="musique.js"></script>
    <script src="script.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js')
                .then(reg => {
                console.log('Le gardien (Service Worker) est bien installÃ© !');
                })
                .catch(err => {
                console.log('Ã‰chec de l\'installation du gardien :', err);
                });
            });
        }
    </script>
</body>
</html>